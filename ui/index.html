
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Repo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      .pkg-info {
		width: 90%;
		padding: 5px;
		margin-left:8px;
		border: solid 1px silver;
		background: #DFEFEF;		
      }
      .pkg-search-ahead {
      	width: 90%;
      }

    </style>    

  	
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="bootstrap/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="bootstrap/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="bootstrap/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="bootstrap/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="bootstrap/ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="bootstrap/ico/favicon.png">
</head>	

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">          
          <a class="brand" href="#">MailOnline Repo</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>              
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

   
      <div class="container-fluid">
		  <div class="row-fluid">
		    <div class="span3">
		      <!--Sidebar content-->
		      <input type="text" class='pkg-search-ahead search-query' data-source="searchIndexFn">
		      <div class='pkg-info'>
		      </div>
		    </div>
		    <div class="span9">
		      <!--Body content-->
		       <div class='pkg-preview'>
		      </div>		      
		    </div>
		  </div>
		</div>
   <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="bootstrap/js/jquery.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="bootstrap/js/lodash.min.js"></script>
    <script src="bootstrap/js/mustache.js"></script>
    
    <script>   

		  $('.pkg-search-ahead').typeahead({
		    source: function(query, process) {
		        return $.ajax({
		            url: '/api/index/search/' + query,
		            type: 'get',		            
		            dataType: 'json',
		            success: function(json) {		                
		                process(_.pluck(json,'name'))		               
		            }
		        });
		    },
		    updater:function (item) {
		    	selectPackage(item);
		        //dont forget to return the item to reflect them into input
		        return item;
		    },
		    minLength: 2
		});

		function selectPackage(item) {
			$.ajax({
	            url: '/api/info/' + item,
	            type: 'get',		            
	            dataType: 'json',
	            success: function(json) {	
	           		$('.pkg-info').empty().append($('#pkg-info-template').mustache(json));            
	           		$('.pkg-preview').empty().append($('#pkg-preview-template').mustache(json));            
	            }
	        });
		}

   </script>

   <script id='pkg-info-template' type='text/html'>
   		<h4>{{name}}</h4>
   		<p>{{description}}</p>
   		<p>Live: {{live}}</p>
   		<p>Versions: {{#versionList}}{{.}},{{/versionList}}</p>
   		<h5>Readme</h5>
   		<p>{{readme}}</p>
   </script>

   <script id='pkg-preview-template' type='text/html'>
   		<iframe src='/preview/{{name}}?latest=true' width='100%' height='600px' frameborder="0"></iframe>  		
   </script>
    
  </body>
</html>
